    private void generateImageFile(File file) {
        // Extension is chosen based on the file name, not the dialog filter selection.
        int extension = EXTENSION_MAP.get(Path.fromOSString(file.getName()).getFileExtension());

        Display dsp = Display.getCurrent();
        GC gc = new GC(contents);
        Image img = new Image(dsp, contents.getSize().x, contents.getSize().y);
        gc.copyArea(img, 0, 0);
        gc.dispose();
        ImageLoader imageLoader = new ImageLoader();
        imageLoader.data = new ImageData[] { img.getImageData() };
        imageLoader.save(file.getAbsolutePath(), extension);
    }

