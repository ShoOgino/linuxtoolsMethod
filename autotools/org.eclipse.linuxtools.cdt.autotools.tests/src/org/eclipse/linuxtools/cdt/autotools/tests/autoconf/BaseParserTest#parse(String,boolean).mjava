	protected AutoconfElement parse(String string, boolean allowErrors) {
		IDocument document = createDocument(string);
		AutoconfElement root1 = parseNoHandlers(document);
		assertNotNull(root1);
		AutoconfElement root2 = parseWithHandlers(document);
		assertNotNull(root2);
	
		validateSourceTree(root1);
		validateSourceTree(root2);
	
		// TODO: check root1 == root2
		
		// ensure the doc wasn't changed (sanity)
		assertEquals(string, document.get());
	
		if (!allowErrors) {
			if (errors.size() > 0)
				fail("got errors" + errors.get(0));
		}
		else
			assertTrue(errors.size() > 0);
		
		return root2;
	}

