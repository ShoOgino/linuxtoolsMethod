    @Override
    public Image getImage(Object element) {

        if (element instanceof TmfTraceElement) {
            TmfTraceElement trace = (TmfTraceElement) element;
            try {
                String traceType = trace.getResource().getPersistentProperty(TmfCommonConstants.TRACETYPE);
                if (traceType == null) {
                    return fUnknownTraceIcon;
                }

                IConfigurationElement traceUIAttributes = TmfTraceTypeUIUtils.getTraceUIAttributes(traceType);
                String name = trace.getResource().getPersistentProperty(TmfCommonConstants.TRACEBUNDLE);
                String icon = trace.getResource().getPersistentProperty(TmfCommonConstants.TRACEICON);
                if (traceUIAttributes != null) {
                    String iconAttr = traceUIAttributes.getAttribute(TmfTraceTypeUIUtils.ICON_ATTR);
                    if (iconAttr != null) {
                        name = traceUIAttributes.getContributor().getName();
                        icon = iconAttr;
                    }
                }

                if (name != null && icon != null) {
                    Bundle bundle = Platform.getBundle(name);
                    if (bundle != null) {
                        Image image = loadIcon(bundle, icon);
                        if (image != null) {
                            return image;
                        }
                    }
                    return fUnknownTraceIcon;
                }
            } catch (CoreException e) {
            }
            return fDefaultTraceIcon;
        }

        if (element instanceof TmfExperimentElement) {
            return fExperimentIcon;
        }

        if (element instanceof TmfExperimentFolder) {
            return fExperimentFolderIcon;
        }

        if (element instanceof TmfTraceFolder) {
            return fTraceFolderIcon;
        }

        if (element instanceof TmfAnalysisOutputElement) {
            TmfAnalysisOutputElement output = (TmfAnalysisOutputElement) element;
            Image icon = output.getIcon();
            if (icon == null) {
                return fDefaultViewIcon;
            }
            return icon;
        }

        if (element instanceof TmfAnalysisElement) {
            TmfAnalysisElement analysis = (TmfAnalysisElement) element;
            String iconFile = analysis.getIconFile();
            if (iconFile != null) {
                Bundle bundle = analysis.getBundle();
                if (bundle != null) {
                    Image icon = loadIcon(bundle, iconFile);
                    return icon;
                }
            }
            return fDefaultAnalysisIcon;
        }

        return null;
    }

