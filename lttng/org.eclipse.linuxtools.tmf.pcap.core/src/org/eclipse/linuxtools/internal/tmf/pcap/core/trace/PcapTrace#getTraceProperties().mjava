    @Override
    public synchronized Map<String, String> getTraceProperties() {
        PcapFile pcap = fPcapFile;
        if (pcap == null) {
            return EMPTY_MAP;
        }

        ImmutableMap<String, String> properties = fTraceProperties;
        if (properties == null) {
            @SuppressWarnings("null")
            @NonNull ImmutableMap<String, String> newProperties = ImmutableMap.<String, String> builder()
                    .put(Messages.PcapTrace_Version, String.format("%d%c%d", pcap.getMajorVersion(), '.', pcap.getMinorVersion())) //$NON-NLS-1$
                    .put(Messages.PcapTrace_TimeZoneCorrection, pcap.getTimeZoneCorrection() + " s") //$NON-NLS-1$
                    .put(Messages.PcapTrace_TimestampAccuracy, String.valueOf(pcap.getTimeAccuracy()))
                    .put(Messages.PcapTrace_MaxSnapLength, pcap.getSnapLength() + " bytes") //$NON-NLS-1$
                    .put(Messages.PcapTrace_LinkLayerHeaderType, LinkTypeHelper.toString((int) pcap.getDataLinkType()) + " (" + pcap.getDataLinkType() + ")") //$NON-NLS-1$ //$NON-NLS-2$
                    .put(Messages.PcapTrace_FileEndianness, pcap.getByteOrder().toString())
                    .build();
            fTraceProperties = newProperties;
            return newProperties;

        }

        return properties;
    }

