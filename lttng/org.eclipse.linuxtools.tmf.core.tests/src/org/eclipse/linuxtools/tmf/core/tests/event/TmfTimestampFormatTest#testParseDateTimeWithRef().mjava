    /**
     * Test parsing of date and time patterns with reference time
     *
     * @throws ParseException
     *             should not happen, if it does, the test is a failure
     */
    @Test
    public void testParseDateTimeWithRef() throws ParseException {
        long ref = tsf.parseValue("2014-11-22 12:34:56.123456789"); // Saturday
        long time;

        time = new TmfTimestampFormat("yyyy", GMT).parseValue("1970", ref);
        assertEquals("1970-01-01 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("YYYY", GMT).parseValue("1970");
        assertEquals("1969-12-28 00:00:00.000000000", tsf.format(time)); // 1st day of week 1

        time = new TmfTimestampFormat("MM", GMT).parseValue("01", ref);
        assertEquals("2014-01-01 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("ww", GMT).parseValue("01", ref);
        assertEquals("2014-01-04 00:00:00.000000000", tsf.format(time)); // Saturday of week 1

        time = new TmfTimestampFormat("DDD", GMT).parseValue("1", ref);
        assertEquals("2014-01-01 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("F", GMT).parseValue("2", ref);
        assertEquals("2014-11-08 00:00:00.000000000", tsf.format(time)); // 2nd Saturday of month

        time = new TmfTimestampFormat("EEE", GMT).parseValue("Mon", ref);
        assertEquals("2014-11-17 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("u", GMT).parseValue("1", ref);
        assertEquals("2014-11-17 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("dd", GMT).parseValue("01", ref);
        assertEquals("2014-11-01 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("HH", GMT).parseValue("00", ref);
        assertEquals("2014-11-22 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("kk", GMT).parseValue("24", ref);
        assertEquals("2014-11-22 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("KK", GMT).parseValue("00", ref);
        assertEquals("2014-11-22 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("hh", GMT).parseValue("12", ref);
        assertEquals("2014-11-22 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("mm", GMT).parseValue("00", ref);
        assertEquals("2014-11-22 12:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("ss", GMT).parseValue("00", ref);
        assertEquals("2014-11-22 12:34:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat(".S", GMT).parseValue(".0", ref);
        assertEquals("2014-11-22 12:34:56.000000000", tsf.format(time));

        time = new TmfTimestampFormat("T.S", GMT).parseValue("0.0", ref);
        assertEquals("1970-01-01 00:00:00.000000000", tsf.format(time));

        time = new TmfTimestampFormat("T.S", GMT).parseValue(".0", ref);
        assertEquals("1970-01-01 00:00:00.000000000", tsf.format(time));
    }

