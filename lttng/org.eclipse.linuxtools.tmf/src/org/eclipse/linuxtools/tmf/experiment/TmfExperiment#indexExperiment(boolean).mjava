	@SuppressWarnings("unchecked")
	private void indexExperiment(boolean waitForCompletion) {

		fCheckpoints.clear();
		
//		fEventLog = openLogFile("TraceEvent.log");
//		System.out.println(System.currentTimeMillis() + ": Experiment indexing started");

		ITmfEventRequest<TmfEvent> request = new TmfEventRequest<TmfEvent>(TmfEvent.class, TmfTimeRange.Eternity, TmfDataRequest.ALL_DATA, 1, ITmfDataRequest.ExecutionType.BACKGROUND) {

//			long indexingStart = System.nanoTime();
			
			TmfTimestamp startTime =  null;
			TmfTimestamp lastTime  =  null;

			@Override
			public void handleData() {
				TmfEvent[] events = getData();
				if (events.length > 0) {

//					try {
//						if (fEventLog != null) {
//							fEventLog.write(events[0].getTimestamp().toString());
//							fEventLog.newLine();
//							fEventLog.flush();
//						}
//					} catch (IOException e) {
//						e.printStackTrace();
//					}
					
					TmfTimestamp ts = events[0].getTimestamp();
					if (startTime == null)
						startTime = new TmfTimestamp(ts);
					lastTime = new TmfTimestamp(ts);

					if ((fNbRead % DEFAULT_INDEX_PAGE_SIZE) == 0) {
						updateExperiment();
					}
				}
			}

			@Override
			public void handleSuccess() {

//				try {
//					fEventLog.close();
//					fEventLog = null;
//				} catch (IOException e) {
//					e.printStackTrace();
//				}

//				long indexingEnd = System.nanoTime();

				updateExperiment();
//				System.out.println(System.currentTimeMillis() + ": Experiment indexing completed");
//
//				long average = (indexingEnd - indexingStart) / fNbEvents;
//				System.out.println(getName() + ": start=" + startTime + ", end=" + lastTime + ", elapsed=" + (indexingEnd * 1.0 - indexingStart) / 1000000000);
//				System.out.println(getName() + ": nbEvents=" + fNbEvents + " (" + (average / 1000) + "." + (average % 1000) + " us/evt)");

//				 for (int i = 0; i < fCheckpoints.size(); i++) {
//					 TmfCheckpoint checkpoint = fCheckpoints.get(i);
//					 System.out.println("fCheckpoints[" + i + "] " + checkpoint.getTimestamp() + ", " + checkpoint.getLocation().toString());
//				 }
			}

			private void updateExperiment() {
				if (fNbRead != 0) {
					fTimeRange = new TmfTimeRange(startTime, new TmfTimestamp(lastTime));
					fNbEvents  = fNbRead;
					notifyListeners();
				}
			}
		};

		sendRequest((ITmfDataRequest<T>) request);
		if (waitForCompletion)
			try {
				request.waitForCompletion();
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
	}

