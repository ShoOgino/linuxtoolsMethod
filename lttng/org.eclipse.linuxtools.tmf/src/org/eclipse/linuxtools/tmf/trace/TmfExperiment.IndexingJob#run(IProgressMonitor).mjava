		/* (non-Javadoc)
		 * @see org.eclipse.core.runtime.jobs.Job#run(org.eclipse.core.runtime.IProgressMonitor)
		 */
		@Override
		protected IStatus run(IProgressMonitor monitor) {

			Vector<TmfTraceContext[]> indices = new Vector<TmfTraceContext[]>();
			
			// Minimal check
			if (fTraces.size() == 0) {
	            fIndexing = false;
				return Status.OK_STATUS;
			}

			monitor.beginTask("Indexing " + fExperimentId, IProgressMonitor.UNKNOWN);

    		ITmfTrace[] traces = new ITmfTrace[0];
    		TmfTraceContext[] contexts;
    		int nbTraces = fTraces.size();

    		// Initialize the traces and contexts arrays
    		traces = fTraces.toArray(traces);
    		contexts = new TmfTraceContext[nbTraces];
    		TmfTraceContext[] savedContexts = new TmfTraceContext[nbTraces];
			int nullEvents = 0;
    		for (int i = 0; i < nbTraces; i++) {
    			// Context of the first event of the trace
    			contexts[i] = traces[i].seekLocation(null);
    			savedContexts[i] = new TmfTraceContext(contexts[i].getLocation(), contexts[i].getTimestamp(), 0);
    			if (contexts[i].getTimestamp() == null)
    				nullEvents++;
    		}
    		// Check if there is anything to index
    		if (nullEvents >= nbTraces) {
	            fIndexing = false;
				return Status.OK_STATUS;
    		}
    		// FIXME: LTTng hack - start
//			indices.add(savedContexts);	// TMF
    		// FIXME: LTTng hack - end
    		
    		// Get the ordered events and populate the indices
    		// FIXME: LTTng hack - start
//    		int nbEvents = 0; // TMF
    		int nbEvents = -1; // LTTng
    		// FIXME: LTTng hack - end
    		while ((getNextEvent(traces, contexts)) != null)
    		{
    			if (++nbEvents % fIndexPageSize == 0) {
    				// Special case: if the total number of events is a multiple of the
    				// DEFAULT_PAGE_SIZE then all the pending events are null. In that
    				// case, we don't store an additional entry in the index array.
    				nullEvents = 0;
    				savedContexts = new TmfTraceContext[nbTraces];
    	    		for (int i = 0; i < nbTraces; i++) {
    	    			savedContexts[i] = new TmfTraceContext(contexts[i]);
    	    			if (contexts[i].getTimestamp() ==  null)
    	    				nullEvents++;
    	    		}
    	    		if (nullEvents < nbTraces) {
    	    			indices.add(savedContexts);
    	    		}
    			}

    			monitor.worked(1);
                if (monitor.isCanceled()) {
                    monitor.done();
                	return Status.CANCEL_STATUS;
                }
    		}

            monitor.done();
            fExperimentIndex = indices;

//            dumpIndex();

            fIndexing = false;
            return Status.OK_STATUS;
		}

