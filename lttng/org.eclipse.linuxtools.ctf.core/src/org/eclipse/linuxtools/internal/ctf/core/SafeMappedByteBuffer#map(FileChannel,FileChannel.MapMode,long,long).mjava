    /**
     * Maps a region of this channel's file directly into memory. On Windows,
     * this will allocate a new ByteBuffer and read the file.
     *
     * @param fc
     *            the file channel
     * @param mode
     *            the mapping mode
     * @param position
     *            the position within the file
     * @param size
     *            the size of the region to be mapped (or read)
     * @return the mapped ByteBuffer
     * @throws IOException
     *             on FileChannel operations failures
     */
    public static ByteBuffer map(FileChannel fc, FileChannel.MapMode mode, long position, long size) throws IOException {
        ByteBuffer byteBuffer;
        if (IS_WIN32) {
            byteBuffer = ByteBuffer.allocate((int) size);
            fc.read(byteBuffer, position);
        } else {
            byteBuffer = fc.map(mode, position, size);
        }

        return byteBuffer;
    }

