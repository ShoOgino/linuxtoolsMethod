    /**
     * Parse the root node.
     *
     * @param root
     *            A ROOT node.
     * @throws ParseException
     */
    private void parseRoot(CommonTree root) throws ParseException {

        List<CommonTree> children = root.getChildren();

        CommonTree traceNode = null;
        List<CommonTree> streams = new ArrayList<>();
        List<CommonTree> events = new ArrayList<>();
        List<CommonTree> declarations = new ArrayList<>();
        List<CommonTree> environments = new ArrayList<>();
        List<CommonTree> clocks = new ArrayList<>();
        List<CommonTree> callsites = new ArrayList<>();

        /* Create a new declaration scope with no parent. */
        pushScope();

        for (CommonTree child : children) {
            final int type = child.getType();
            switch (type) {
            case CTFParser.DECLARATION:
                declarations.add(child);
                break;
            case CTFParser.TRACE:
                if (traceNode != null) {
                    throw new ParseException("Only one trace block is allowed"); //$NON-NLS-1$
                }
                traceNode = child;
                break;
            case CTFParser.STREAM:
                streams.add(child);
                break;
            case CTFParser.EVENT:
                events.add(child);
                break;
            case CTFParser.CLOCK:
                clocks.add(child);
                break;
            case CTFParser.ENV:
                environments.add(child);
                break;
            case CTFParser.CALLSITE:
                callsites.add(child);
                break;
            default:
                childTypeError(child);
            }
        }
        for (CommonTree decl : declarations) {
            parseRootDeclaration(decl);
        }
        if (traceNode == null) {
            throw new ParseException("Missing trace block"); //$NON-NLS-1$
        }

        parseTrace(traceNode);

        for (CommonTree environment : environments) {
            parseEnvironment(environment);
        }
        for (CommonTree clock : clocks) {
            parseClock(clock);
        }
        for (CommonTree callsite : callsites) {
            parseCallsite(callsite);
        }

        if (!streams.isEmpty()) {
            for (CommonTree stream : streams) {
                parseStream(stream);
            }
        } else {
            /* Add an empty stream that will have a null id */
            fTrace.addStream(new CTFStream(fTrace));
        }

        for (CommonTree event : events) {
            parseEvent(event);
        }
        popScope();
        fHasBeenParsed = true;
    }

