    /**
     * @since 3.0
     */
    @Override
    public VariantDefinition createDefinition(IDefinitionScope definitionScope,
            String fieldName, BitBuffer input) throws CTFReaderException {
        alignRead(input);
        if (fPrevDefinitionScope != definitionScope) {
            fTagDef = null;
            fPrevDefinitionScope = definitionScope;
        }
        EnumDefinition tagDef = fTagDef;
        if (tagDef == null) {
            Definition def = definitionScope.lookupDefinition(fTag);
            tagDef = (EnumDefinition) ((def instanceof EnumDefinition) ? def : null);
        }
        if (tagDef == null) {
            throw new CTFReaderException("Tag is not defined " + fTag); //$NON-NLS-1$
        }
        String varFieldName = tagDef.getStringValue();
        fDeclarationToPopulate = fFields.get(varFieldName);
        if (fDeclarationToPopulate == null) {
            throw new CTFReaderException("Unknown enum selector for variant " + //$NON-NLS-1$
                    definitionScope.getScopePath().toString());
        }
        Definition fieldValue = fDeclarationToPopulate.createDefinition(definitionScope, fieldName, input);
        return new VariantDefinition(this, definitionScope, varFieldName, fieldName, fieldValue);
    }

