    /**
     * Method that is called when the filter accepts a packet. This methods add
     * the packet to a stream based on its characteristics.
     *
     * @param packet
     *            The packet to be added.
     */
    public synchronized void addPacketToStream(PcapPacket packet) {
        if (fPacketFilter.accepts(packet)) {
            @Nullable Packet newPacket = packet.getPacket(fProtocol);
            if (newPacket == null) {
                return;
            }
            ProtocolEndpointPair endpointSet = new ProtocolEndpointPair(newPacket);
            if (!fIDs.containsKey(endpointSet)) {
                fIDs.put(endpointSet, fCurrentId);
                fStreams.put(fCurrentId, new PacketStream(fProtocol, fCurrentId, endpointSet));
                fStreams.get(fCurrentId).add(packet);
                fCurrentId++;
            } else {
                Integer id = fIDs.get(endpointSet);
                fStreams.get(id).add(packet);
            }
        }
        return;
    }

