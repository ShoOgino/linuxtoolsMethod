	protected void saveState() throws CoreException, IOException {
		XMLMemento memento = XMLMemento.createWriteRoot(MementoConstants.ELEMENT_ROOT);
		memento.putString(MementoConstants.ELEMENT_CONFIG, config.getMemento());
		memento.putString(MementoConstants.ELEMENT_LOCATOR, ((IPersistableSourceLocator) launch.getSourceLocator()).getMemento());
		memento.putString(MementoConstants.ELEMENT_LABEL, process.getLabel());
		memento.putString(MementoConstants.ELEMENT_DATADIR, command.getDatadir().getCanonicalPath());
		
		IValgrindPersistable persistable = ValgrindHistoryPlugin.getDefault().getPersistable(toolID);
		if (persistable != null) {
			persistable.saveState(memento);
		}
		
		// write launch history to history file
		HistoryFile.getInstance().write(launchStr, memento, command.getDatadir());
	}

