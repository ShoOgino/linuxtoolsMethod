	private void write1(final byte[] b, final int off, final int len) throws IOException {
		done = false;
		ex = null;

		streamsService.write(streamId, b, off, len, new DoneWrite() {

			public void doneWrite(IToken token, Exception error) {
				if (error != null) {
					ex = null;
				}
				else {
					done = true;
				}
			}
		});
		
		try {
			while (!done) {
				Thread.sleep(100);
			}
		} catch (InterruptedException e) {
		}
		
		if (ex != null) {
			throw new IOException(ex);
		}
	}

