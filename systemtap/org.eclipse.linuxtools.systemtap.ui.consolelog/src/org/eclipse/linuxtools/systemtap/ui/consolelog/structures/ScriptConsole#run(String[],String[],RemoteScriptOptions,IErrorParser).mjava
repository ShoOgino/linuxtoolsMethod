    /**
     * Runs the provided command in this ScriptConsole instance.
     * @param command The command and arguments to run.
     * @param envVars The environment variables to use while running
     * @param remoteOptions The remote options (such as username and password) to run the script with.
     * @param errorParser The parser to handle error messages generated by the command
     * @since 3.0
     */
    public void run(String[] command, String[] envVars, final RemoteScriptOptions remoteOptions, IErrorParser errorParser) {
        // Don't start a new command if one is already waiting to be started.
        if (waitingToStart()) {
            return;
        }
        cmd = new ScpExec(command, remoteOptions, envVars);

        stopCommand = new StopCommand(cmd, getStopString()) {
            ScpExec stop = new ScpExec(new String[]{stopString}, remoteOptions, null);

            @Override
            protected void stop() throws CoreException {
                stop.start();
            }
        };

        this.run(cmd, errorParser);
    }

