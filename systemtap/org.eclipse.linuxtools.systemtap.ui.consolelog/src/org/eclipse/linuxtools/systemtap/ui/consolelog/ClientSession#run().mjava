	@Override
	public void run () {

		while (!Thread.interrupted()) {

			final byte[] headBuffer = new byte[DMResponse.packetsize];
			final byte[] bodyBuffer;
			DMResponse header;

			try {
	//		    Boolean first = new Boolean(true);
				in.read(headBuffer, 0, headBuffer.length);
				header = new DMResponse (headBuffer);
		        if(header.isValid())
		        {
		        	bodyBuffer = new byte[header.getsize()];
					in.read(bodyBuffer, 0, bodyBuffer.length);
					if(header.getsource() == DMResponse.SUBSCRIPTION_MGR)
					{
						if(!mbox.containsKey(header.getscriptID()))
							mbox.put(header.getscriptID (), new LinkedBlockingQueue<byte[]> ());
						mbox.get(header.getscriptID()).put(header.tobytes());
						mbox.get(header.getscriptID()).put(bodyBuffer);

					}
					else
					{
						if(!mbox.containsKey(header.getscriptID()))
							mbox.put(header.getscriptID (), new LinkedBlockingQueue<byte[]> ());
						mbox.get(header.getscriptID()).put(header.tobytes());
						mbox.get(header.getscriptID()).put(bodyBuffer);

					}
				}
		       else {
					// either the header was not valid,
					// or the scriptid has not been seen before..

				}

			} catch (InterruptedException ie) {
				// probably shutting down
				System.err.println ("Interrupted: " + ie.getMessage());
				break;

			} catch (IOException ioe) {
				new ErrorMessage("I/O Error Check host!", "See stderr for more details").open();
				System.err.println ("i/o error: " + ioe.getMessage());
				return;
			}
		} // while
		this.destroyConnection();

	}

