	@Override
	public IStatus runInUIThread(IProgressMonitor monitor) {
		
		//-------------Initialize shell, menu
		treeSize = 200;

		
		//OPEN UP THE SYSTEMTAPVIEW IF IT IS NOT ALREADY OPEN
		SystemTapView.forceDisplay();
		
		Composite treeComp = SystemTapView.makeTreeComp(treeSize);
		Composite graphComp = SystemTapView.makeGraphComp();
		
		g = new StapGraph(graphComp, SWT.NONE, treeComp);

		
		//-------------Load graph data
		g.loadData(SWT.NONE, 0, StapGraph.CONSTANT_TOP_NODE_NAME, parser.timeMap.get(0), 1, -1, false, ""); //$NON-NLS-1$
		boolean marked = false;
		String msg;
		
		
	    for (int id_parent : parser.serialMap.keySet()) {
	    	
			for (int id_child : parser.outNeighbours.get(id_parent)) {
				if (monitor.isCanceled()) {
					return Status.CANCEL_STATUS;
				}
				marked = false;
				msg = ""; //$NON-NLS-1$
				if (id_child != -1) {
					
//					if (parser.markedMap.keySet() != null) {
//						if (parser.markedMap.keySet().contains(id_child)) {
//							msg = parser.markedMap.get(id_child);							
//							parser.markedMap.keySet().remove((Integer)id_child);
//							marked = true;
//						}
//					}
					
					if (parser.timeMap.get(id_child) == null){						
						g.loadData(SWT.NONE, id_child, parser.serialMap
								.get(id_child), parser.timeMap.get(0),
								1, id_parent, marked,msg);
					}else{
						g.loadData(SWT.NONE, id_child, parser.serialMap
								.get(id_child), parser.timeMap.get(id_child),
								1, id_parent, marked,msg);
					}
				}
			}
		}

	    
	    g.aggregateCount = parser.countMap;
	    g.aggregateTime = parser.cumulativeTimeMap;

	    //Set total time (automatically seeks highest useful node)
	    g.setTotalTime();
	    
	    //-------------Finish initializations
	    //Generate data for collapsed nodes
	    g.recursivelyCollapseAllChildrenOfNode(g.getTopNode());
		if (monitor.isCanceled()) {
			return Status.CANCEL_STATUS;
		}
	    g.initializeTree();
	    

	    g.draw(StapGraph.CONSTANT_DRAWMODE_RADIAL, StapGraph.CONSTANT_ANIMATION_SLOW,
	    		g.getFirstUsefulNode());
		if (monitor.isCanceled()) {
			return Status.CANCEL_STATUS;
		}
	    g.setFocus();
	    
	    SystemTapView.setValues(graphComp, treeComp, g, parser);
	    SystemTapView.createPartControl();
	    
		return Status.OK_STATUS;
	}

