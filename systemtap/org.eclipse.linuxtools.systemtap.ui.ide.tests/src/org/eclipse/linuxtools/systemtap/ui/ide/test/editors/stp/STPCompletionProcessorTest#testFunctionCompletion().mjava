	@Test
	public void testFunctionCompletion() throws BadLocationException, InterruptedException {
		assumeTrue(stapInstalled());

		MyUpdateListener updateListiner = new MyUpdateListener();
		Document testDocument = new Document(TEST_STP_SCRIPT);
		@SuppressWarnings("unused")
		MockSTPEditor editor = new MockSTPEditor(testDocument);

		int offset = TEST_STP_SCRIPT.indexOf("//marker1");
		String prefix = "probe syscall.write{user_}";
		testDocument.replace(offset, 0, prefix);
		offset += prefix.length() - 1;

		STPCompletionProcessor completionProcessor = new STPCompletionProcessor();
		TapsetLibrary.addListener(updateListiner);

		synchronized (updateListiner) {
			if(!TapsetLibrary.isFinishSuccessful())
				updateListiner.wait();
		}

		ICompletionProposal[] proposals = completionProcessor
				.computeCompletionProposals(testDocument,
						offset);

		assertTrue(proposalsContain(proposals, "user_int16"));
		assertTrue(proposalsContain(proposals, "user_int32"));
		assertTrue(proposalsContain(proposals, "user_int64"));
	}

