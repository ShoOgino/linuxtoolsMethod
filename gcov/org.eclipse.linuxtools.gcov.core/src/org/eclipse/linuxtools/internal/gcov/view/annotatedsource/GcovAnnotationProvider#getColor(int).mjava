    @Override
    public Color getColor(int ln) {
        if (!initialized) {
            initColors();
        }
        Display display = PlatformUI.getWorkbench().getDisplay();
        if (COLORIZE_CODE) {
            final int index = ln + 1;
            if (index < lineCount) {
                ArrayList<Line> lines = sourceFile.getLines();
                Line line = lines.get(index);
                if (line.exists()) {
                    long count = line.getCount();
                    if (count == 0) {
                        return RED;
                    }
                    if (!USE_GRADIENT || count == sourceFile.getmaxLineCount()) {
                        return GREEN_MAX;
                    }
                    int colorIndex = 128 - (int) ((128 * count) / sourceFile.getmaxLineCount());
                    if (GREENCOLORS[colorIndex] == null) {
                        int r = GREEN_MIN.getRed() + (GREEN_MAX.getRed() - GREEN_MIN.getRed()) / colorIndex;
                        int v = GREEN_MIN.getGreen() + (GREEN_MAX.getGreen() - GREEN_MIN.getGreen()) / colorIndex;
                        int b = GREEN_MIN.getBlue() + (GREEN_MAX.getBlue() - GREEN_MIN.getBlue()) / colorIndex;
                        GREENCOLORS[colorIndex] = new Color(display, r, v, b);
                    }
                    return GREENCOLORS[colorIndex];
                }
            }
        }
        return display.getSystemColor(SWT.COLOR_WHITE);
    }

