	/**
	 * Returns the annotations whose positions intersect with the given region.
	 * 
	 * @param model the annotation model or <code>null</code>
	 * @param region the document region of interest
	 * @return the list of tuples whose annotations intersect with
	 *         <code>region</code>
	 */
	private List<Tuple> getAnnotations(IAnnotationModel model, final IRegion region) {
		if (model == null || region == NO_REGION)
			return Collections.EMPTY_LIST;

		List<Tuple> annotations= new ArrayList<Tuple>();
		Iterator<Annotation> iterator= model.getAnnotationIterator();
		
		while (iterator.hasNext()) {
			Annotation annotation= iterator.next();
			Position position= model.getPosition(annotation);
			
			if (position == null)
				continue;
			
			Tuple tuple= new Tuple(annotation, position);
			if (internalFilter(tuple, region))
				continue;
			
			if (annotation instanceof AnnotationBag) {
				AnnotationBag bag= (AnnotationBag) annotation;
				Iterator<Annotation> e= bag.iterator();
				while (e.hasNext()) {
					annotation= e.next();
					position= model.getPosition(annotation);
					if (position != null)
						annotations.add(new Tuple(annotation, position));
				}
				continue;
			} 
			
			annotations.add(tuple);
		}
		
		return annotations;
	}

